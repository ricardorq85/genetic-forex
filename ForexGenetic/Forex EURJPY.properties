URL_DB=jdbc:oracle:thin:@localhost:1521/forex.eurjpy
USER_DB=FOREX
PWD_DB=forex

PAIR=EURJPY
PAIR_COMPARE=EURUSD
PERIOD_LOAD=1
FILE_ID=201604280533

ROOT_POBLACION=1
INITIAL_POBLACION=1
END_POBLACION=1
NUMBER_BACK_ROOT_POBLACION=-1
PRESENT_NUMBER_POBLACION=1
RECALCULATE_ALL=FALSE
SHOW_OPERATIONS=TRUE
TEST_FILE=

TEST_STRATEGY=1343862270390.14
1330600388130.9730
1327698225613.318
1331601592515.39178
1327975135464.38002
1329420847661.3064
1334286483382.128
VALIDATION_ID=1343008856673

RISK_LEVEL=8
VALIDATION_NUMBER=1
VALIDATION_ACTIVE=FALSE
LISTING_ID=1338955827148
LISTING_NUMBER=100
OPTIMIZE_TEST=FALSE
POBLACION_BASE=

INITIAL_INDIVIDUOS=2
INDIVIDUOS=100
GENERATIONS=3
READ_HARDEST=3
CROSSOVER=10
MUTATION=50
OPTIMIZATION=1
MAX_FILE_PER_READ=3

READ_SPECIFIC=FALSE
FORCE_INDIVIDUOS=FALSE
SHOW_HARDEST=5

TERMINAR=FALSE
THREAD=TRUE
LOG_LEVEL=1
@NEW
MIN_OPER_NUM_BY_PERIOD=0.1
VIGENCIA=25
HAS_MINIMUM_CRITERION_LEVEL=5
SHOW_ESTADISTICAS=TRUE
NUMBER_LEARNING=10

OPERATION_TYPE=OperationType.Sell
FORTALEZA_TYPE=FortalezaType.Pips
PIPS_FIXER=0.0
MOD_POINTS=7200
SHOW_WEAKEST=5
POINTS_CONTROL=Integer.MAX_VALUE
MINIMUN_FORTALEZA=1000.0
MIN_TP=200
MAX_TP=1000
MIN_SL=200
MAX_SL=1000
MIN_LOT=0.1
MAX_LOT=0.1
MIN_BALANCE=2000
MAX_BALANCE=10000
PAIR_FACTOR=1000.0
MARGIN_REQUIRED=280.0
MINIMUM_INDIVIDUOS=10
DEFAULT_SCALE_ROUNDING=3
LOT_SCALE_ROUNDING=2
FILE_PATH=files/
SERIALICE_PATH=../serialice/
LOG_PATH=log/
LEARNING_PATH=../learning/

QUERY_INDIVIDUOS=SELECT * FROM (SELECT IND.ID ID_INDIVIDUO, MAX(PROC.FECHA_HISTORICO) /*TO_DATE('2015/04/22 19:33', 'YYYY/MM/DD HH24:MI')*/ FECHA_HISTORICO, /*TO_DATE('2015/04/22 19:34', 'YYYY/MM/DD HH24:MI')*/ MAX(OPER.FECHA_APERTURA) FECHA_APERTURA \
FROM INDIVIDUO IND \
INNER JOIN INDICADOR_INDIVIDUO II ON II.ID_INDIVIDUO=IND.ID \
LEFT JOIN PROCESO PROC ON IND.ID=PROC.ID_INDIVIDUO \
LEFT JOIN OPERACION OPER ON IND.ID=OPER.ID_INDIVIDUO AND OPER.FECHA_CIERRE IS NULL \
WHERE \
IND.ID NOT IN (SELECT DISTINCT PRO.ID_INDIVIDUO FROM PROCESO PRO WHERE PRO.FECHA_HISTORICO=(SELECT MAX(FECHA) FROM DATOHISTORICO)) \
AND IND.TIPO_INDIVIDUO='INDICADORES' \
<FILTRO_ADICIONAL> \
GROUP BY IND.ID \
ORDER BY IND.ID DESC) \
WHERE ROWNUM<1000

REINICIADOS PARA PROCESAR HASTA 2013/01/03 17:41
qFILTRO_ADICIONAL_1=AND IND.CREATION_DATE IS NULL AND IND.PARENT_ID_1 IS NULL AND IND.PARENT_ID_2 IS NULL AND IND.TAKE_PROFIT>200 AND IND.TAKE_PROFIT<=500
xFILTRO_ADICIONAL_2=AND IND.CREATION_DATE IS NULL AND IND.PARENT_ID_1 IS NULL AND IND.PARENT_ID_2 IS NULL AND IND.TAKE_PROFIT>500
xFILTRO_ADICIONAL_3=AND IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE BETWEEN TO_DATE('2012/04/07', 'YYYY/MM/DD') AND TO_DATE('2012/06/07', 'YYYY/MM/DD')
xFILTRO_ADICIONAL_4=AND IND.CREATION_DATE IS NOT NULL AND IND.CREATION_DATE BETWEEN TO_DATE('2012/02/07', 'YYYY/MM/DD') AND TO_DATE('2012/04/07', 'YYYY/MM/DD')

INITIAL_PIPS_RANGOOPERACIONINDICADOR=2
INITIAL_RETROCESO_RANGOOPERACIONINDICADOR=2
INITIAL_MESES_RANGOOPERACIONINDICADOR=3

FILTRO_ADICIONAL_1=AND IND.ID LIKE '%.%1' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_2=AND IND.ID LIKE '%.%2' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_3=AND IND.ID LIKE '%.%3' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_4=AND IND.ID LIKE '%.%4' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_5=AND IND.ID LIKE '%.%5' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_6=AND IND.ID LIKE '%.%6' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_7=AND IND.ID LIKE '%.%7' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_8=AND IND.ID LIKE '%.%8' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_9=AND IND.ID LIKE '%.%9' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')
FILTRO_ADICIONAL_10=AND IND.ID LIKE '%.%0' AND IND.CREATION_DATE >= TO_DATE('2016/01/01', 'YYYY/MM/DD')

NOMBRE_ESTRATEGIA=ESTABLE_3MESES
QUERY_INDIVIDUOS_OPTIMOS=SELECT IND.ID ID_INDIVIDUO, (OPER_POS.CANTIDAD+OPER_NEG.CANTIDAD) CANTIDAD_TOTAL, \
  ROUND(ABS(OPER_POS.SUMA/OPER_NEG.SUMA),5) FACTOR_PIPS, \
  ROUND((OPER_POS.CANTIDAD/OPER_NEG.CANTIDAD),5) FACTOR_CANTIDAD \
FROM INDIVIDUO IND \
  INNER JOIN \
    (SELECT OPER1.ID_INDIVIDUO FROM OPERACION OPER1 \
    WHERE OPER1.FECHA_APERTURA<(SELECT TO_DATE(VALOR, 'YYYY/MM/DD HH24:MI') FROM PARAMETRO WHERE NOMBRE='FECHA_INDIVIDUO_OPTIMO') \
    AND OPER1.FECHA_APERTURA>ADD_MONTHS((SELECT TO_DATE(VALOR, 'YYYY/MM/DD HH24:MI') FROM PARAMETRO WHERE NOMBRE='FECHA_INDIVIDUO_OPTIMO'),-3) \
    HAVING COUNT(*)>20 \
    GROUP BY OPER1.ID_INDIVIDUO) CONTADOR_OPER \
      ON CONTADOR_OPER.ID_INDIVIDUO=IND.ID \
  LEFT JOIN \
    (SELECT P.ID_INDIVIDUO, SUM(P.PIPS) SUMA, COUNT(*) CANTIDAD FROM OPERACION P \
    WHERE P.PIPS>0  AND P.FECHA_APERTURA<(SELECT TO_DATE(VALOR, 'YYYY/MM/DD HH24:MI') FROM PARAMETRO WHERE NOMBRE='FECHA_INDIVIDUO_OPTIMO') \
    GROUP BY P.ID_INDIVIDUO) OPER_POS \
      ON OPER_POS.ID_INDIVIDUO=IND.ID \
  LEFT JOIN \
    (SELECT P.ID_INDIVIDUO, SUM(P.PIPS) SUMA, COUNT(*) CANTIDAD FROM OPERACION P \
    WHERE P.PIPS<0  AND P.FECHA_APERTURA<(SELECT TO_DATE(VALOR, 'YYYY/MM/DD HH24:MI') FROM PARAMETRO WHERE NOMBRE='FECHA_INDIVIDUO_OPTIMO') \
    GROUP BY P.ID_INDIVIDUO) OPER_NEG \
      ON OPER_NEG.ID_INDIVIDUO=IND.ID \
WHERE ABS(OPER_POS.SUMA/OPER_NEG.SUMA)>=1.8 \
AND (OPER_POS.CANTIDAD/(OPER_POS.CANTIDAD+OPER_NEG.CANTIDAD))>=0.7 \
ORDER BY ABS(OPER_POS.SUMA/OPER_NEG.SUMA) DESC

QUERY_PROCESAR_TENDENCIAS_OLD=SELECT MIN(FECHA) MIN_FECHA, MAX(FECHA) MAX_FECHA, MIN(PIPS_PROB) MIN_PRECIO, MAX(PIPS_PROB) MAX_PRECIO, \
                                 ROUND(SUM(PIPS_PROB*PROB)/SUM(PROB),5) VALOR_MAS_PROBABLE, SUM(CINDIVIDUOS) CANTIDAD  FROM ( \
   SELECT TEN.FECHA_TENDENCIA FECHA, \
    ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_PROB, \
    ROUND(SUM(TEN.PROBABILIDAD)/COUNT(TEN.PROBABILIDAD),5) PROB, \
    COUNT(DISTINCT TEN.ID_INDIVIDUO) CINDIVIDUOS \
    FROM ( \
      SELECT TEN4.FECHA_BASE, TEN4.FECHA_TENDENCIA, TEN4.PRECIO_CALCULADO, TEN4.PROBABILIDAD, TEN4.ID_INDIVIDUO \
      FROM TENDENCIA TEN4 \
      INNER JOIN (SELECT TEN2.ID_INDIVIDUO, TEN2.FECHA_APERTURA, MAX(TEN2.FECHA_BASE) FECHA_BASE \
        FROM TENDENCIA TEN2 \
          WHERE /*(TEN2.FECHA_CIERRE IS NULL OR TEN2.FECHA_TENDENCIA<TEN2.FECHA_CIERRE) ELIMINADO PORQUE EN FECHA BASE NO SABRIA SI LA ORDEN SE VA A CERRAR ANTES QUE LA FECHA ESTIMADA*/  \
/*          AND */ TEN2.FECHA_BASE<? \
        GROUP BY TEN2.ID_INDIVIDUO, TEN2.FECHA_APERTURA \
      ) TEN3 ON TEN4.ID_INDIVIDUO=TEN3.ID_INDIVIDUO \
        AND TEN4.FECHA_APERTURA=TEN3.FECHA_APERTURA \
        AND TEN4.FECHA_BASE=TEN3.FECHA_BASE \
        AND TEN4.FECHA_TENDENCIA>=? \
        AND TEN4.FECHA_TENDENCIA<=? \
        /*AND TEN4.PROBABILIDAD>0.6*/ \
        ) TEN \
    GROUP BY TEN.FECHA_TENDENCIA \
) \
--WHERE PROB>0.7

QUERY_PROCESAR_TENDENCIAS=SELECT MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        MIN(TEN.PRECIO_CALCULADO) MIN_PRECIO2, MAX(TEN.PRECIO_CALCULADO) MAX_PRECIO2, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(SUM(TEN.PROBABILIDAD)/COUNT(TEN.PROBABILIDAD),5) PROMEDIO_PROB, \
        COUNT(*) CANTIDAD \
    FROM ( \
      SELECT MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO, \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM, \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD, \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS \
        FROM TENDENCIA TEN4 \
          INNER JOIN (SELECT ? FECHA_PROCESO FROM DUAL) FP \
          ON TEN4.FECHA_BASE<=FP.FECHA_PROCESO \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO) \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO \
          AND TEN4.FECHA_TENDENCIA<=? \
        GROUP BY TEN4.FECHA_APERTURA \
        ) TEN

QUERY_PROCESAR_TENDENCIAS_VALOR_PROBABLE_SOLOMAXIMAFECHA=SELECT MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(SUM(TEN.PROBABILIDAD)/COUNT(TEN.PROBABILIDAD),5) PROMEDIO_PROB, \
        COUNT(TEN.ID_INDIVIDUO) CANTIDAD \
    FROM ( \
      SELECT TEN4.FECHA_BASE, TEN4.PRECIO_BASE PRECIO_BASE_PROM, TEN4.FECHA_TENDENCIA, TEN4.PRECIO_CALCULADO, TEN4.PROBABILIDAD, TEN4.PIPS, TEN4.ID_INDIVIDUO \
      FROM TENDENCIA TEN4 \
      INNER JOIN (SELECT TEN2.ID_INDIVIDUO, TEN2.FECHA_APERTURA, MAX(TEN2.FECHA_BASE) FECHA_BASE \
        FROM TENDENCIA TEN2 \
          WHERE (TEN2.FECHA_CIERRE IS NULL OR TEN2.FECHA_CIERRE>?) \
          AND TEN2.FECHA_BASE<=? \
        GROUP BY TEN2.ID_INDIVIDUO, TEN2.FECHA_APERTURA \
      ) TEN3 ON TEN4.ID_INDIVIDUO=TEN3.ID_INDIVIDUO \
        AND TEN4.FECHA_APERTURA=TEN3.FECHA_APERTURA \
        AND TEN4.FECHA_BASE=TEN3.FECHA_BASE \
        AND TEN4.FECHA_TENDENCIA>=? \
        AND TEN4.FECHA_TENDENCIA<=? \
        ) TEN

QUERY_PROCESAR_TENDENCIAS_VALOR_PROBABLE=SELECT MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        ROUND(MIN(TEN.PRECIO_CALCULADO),5) MIN_PRECIO_IND, ROUND(MAX(TEN.PRECIO_CALCULADO),5) MAX_PRECIO_IND, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(SUM(TEN.PROBABILIDAD)/COUNT(TEN.PROBABILIDAD),5) PROMEDIO_PROB, \
        SUM(CANTIDAD) CANTIDAD \
    FROM ( \
      SELECT MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO, \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM, \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD, \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS, \
        COUNT(*) CANTIDAD \
        FROM TENDENCIA TEN4 \
          INNER JOIN (SELECT ? FECHA_PROCESO FROM DUAL) FP \
          ON TEN4.FECHA_BASE<FP.FECHA_PROCESO \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO) \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO \
          AND TEN4.FECHA_TENDENCIA<=? \
        GROUP BY TO_CHAR(TEN4.FECHA_TENDENCIA, 'YYYY/MM/DD HH24'),TO_CHAR(TEN4.FECHA_APERTURA, 'YYYY/MM/DD HH24') \
        ) TEN

QUERY_PROCESAR_TENDENCIAS_VALOR_PROBABLE_BASE_20141113=SELECT RES.FECHA_BASE FECHA_BASE, \
    MIN(RES.MIN_FECHA) MIN_FECHA, \
    ROUND(SUM(RES.PRECIO_BASE_PROM)/COUNT(RES.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM,  \
    MIN(RES.MIN_PRECIO) MIN_PRECIO,  \
    MAX(RES.MAX_PRECIO) MAX_PRECIO, \
    (MAX(RES.MAX_PRECIO)-MIN(RES.MIN_PRECIO))*100000 DIFF_MM,  \
    ROUND(SUM(RES.VALOR_MAS_PROBABLE*RES.PROM_PROB)/SUM(RES.PROM_PROB),5) VALOR_MAS_PROBABLE,          \
    ROUND(SUM(RES.PIPS_MAS_PROBABLE*RES.PROM_PROB)/SUM(RES.PROM_PROB),5) PIPS_MAS_PROBABLE,          \
    ROUND(AVG(RES.PROM_PROB),5) PROM_PROB, \
    SUM(CANTIDAD) CANTIDAD, COUNT(*) REG, \
   MAX(RES.MAX_FECHA) MAX_FECHA \
FROM \
( \
SELECT TEN.FECHA_BASE, \
    MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA,  \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM,  \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO,  \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO,  \
        (ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) - \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5))*100000 DIFF_MM,  \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE,  \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE,  \
        ROUND(AVG(TEN.PROBABILIDAD),5) PROM_PROB, \
        SUM(CANTIDAD) CANTIDAD, COUNT(*) REGISTROS \
    FROM ( \
      SELECT \
        TEN4.FECHA_BASE FECHA_BASE, \
        TEN4.TIPO_CALCULO, \
        MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO,  \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM,  \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD,  \
        COUNT(*) CANTIDAD,  \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS \
        FROM TENDENCIA TEN4  \
             INNER JOIN (SELECT ? FECHA_PROCESO FROM DUAL) FP  \
          ON TEN4.FECHA_BASE=FP.FECHA_PROCESO  \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO)  \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO  \
          AND TEN4.FECHA_TENDENCIA<=? \
          AND TEN4.FECHA_APERTURA>FP.FECHA_PROCESO-60 \
		  AND TEN4.TIPO_TENDENCIA='ESTADISTICAS_MAXMIN_23' \
       GROUP BY  \
        TEN4.FECHA_BASE, \
        TO_CHAR(TEN4.FECHA_TENDENCIA, 'YYYY/MM/DD HH24'), \
        TIPO_CALCULO, \
        TO_CHAR(TEN4.FECHA_APERTURA, 'YYYY/MM/DD HH24:MI') \
        ) TEN \
GROUP BY TEN.FECHA_BASE, TO_CHAR(TEN.FECHA_TENDENCIA, 'YYYY/MM/DD HH24') \
HAVING SUM(CANTIDAD)>2 \
AND COUNT(*)>1 \
) RES \
GROUP BY RES.FECHA_BASE

QUERY_PROCESAR_TENDENCIAS_VALOR_PROBABLE_BASE=SELECT /*RES.FECHA_BASE FECHA_BASE, */ \
    MIN(RES.MIN_FECHA) MIN_FECHA, \
    ROUND(SUM(RES.PRECIO_BASE_PROM)/COUNT(RES.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
    MIN(RES.VALOR_MAS_PROBABLE) MIN_PRECIO, \
    MAX(RES.VALOR_MAS_PROBABLE) MAX_PRECIO, \
    (MAX(RES.VALOR_MAS_PROBABLE)-MIN(RES.VALOR_MAS_PROBABLE))*100000 DIFF_MM, \
    ROUND(SUM(RES.VALOR_MAS_PROBABLE*RES.PROM_PROB)/SUM(RES.PROM_PROB),5) VALOR_MAS_PROBABLE, \
    ROUND(SUM(RES.PIPS_MAS_PROBABLE*RES.PROM_PROB)/SUM(RES.PROM_PROB),5) PIPS_MAS_PROBABLE, \
    ROUND(AVG(RES.PROM_PROB),5) PROM_PROB, \
    SUM(CANTIDAD) CANTIDAD, COUNT(*) REG, \
   MAX(RES.MAX_FECHA) MAX_FECHA \
FROM \
( \
SELECT /*TEN.FECHA_BASE, */ \
    MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        (ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) - \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5))*100000 DIFF_MM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(AVG(TEN.PROBABILIDAD),5) PROM_PROB, \
        SUM(CANTIDAD) CANTIDAD, COUNT(*) REGISTROS \
    FROM ( \
      SELECT \
        /*TEN4.FECHA_BASE FECHA_BASE, */ \
        MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO, \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM, \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD, \
        COUNT(*) CANTIDAD, \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS \
        FROM TENDENCIA TEN4 \
             INNER JOIN (SELECT DISTINCT T.FECHA_BASE FECHA_PROCESO FROM TENDENCIA T WHERE T.FECHA_BASE=?) FP \
          ON TEN4.FECHA_BASE=FP.FECHA_PROCESO \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO) \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO \
          AND TEN4.FECHA_TENDENCIA<=? \
          AND TEN4.FECHA_APERTURA>FP.FECHA_PROCESO-60 \
		  AND TEN4.TIPO_TENDENCIA='ESTADISTICAS_MAXMIN_23' \
       GROUP BY \
        /*TEN4.FECHA_BASE, */ \
        TO_CHAR(TEN4.FECHA_TENDENCIA, 'YYYY/MM/DD HH24:MI'), \
        TO_CHAR(TEN4.FECHA_APERTURA, 'YYYY/MM/DD HH24:MI') \
        ) TEN \
GROUP BY /*TEN.FECHA_BASE,*/ \
	TO_CHAR(TEN.FECHA_TENDENCIA, 'YYYY/MM/DD HH24:MI') \
HAVING AVG(TEN.PROBABILIDAD)>0.50 \
/*HAVING SUM(CANTIDAD)>2 */ \
/*AND COUNT(*)>1 */ \
) RES \
/*GROUP BY RES.FECHA_BASE*/

QUERY_PROCESAR_TENDENCIAS_VALOR_PROBABLE_DETALLE=SELECT /*RES.FECHA_BASE FECHA_BASE, */ \
    MIN(RES.MIN_FECHA) MIN_FECHA, \
    ROUND(SUM(RES.PRECIO_BASE_PROM)/COUNT(RES.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
    MIN(RES.VALOR_MAS_PROBABLE) MIN_PRECIO, \
    MAX(RES.VALOR_MAS_PROBABLE) MAX_PRECIO, \
    (MAX(RES.VALOR_MAS_PROBABLE)-MIN(RES.VALOR_MAS_PROBABLE))*100000 DIFF_MM, \
    ROUND(SUM(RES.VALOR_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
    ROUND(SUM(RES.PIPS_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
    ROUND(AVG(RES.PROBABILIDAD),5) PROBABILIDAD, \
    SUM(CANTIDAD) CANTIDAD, COUNT(*) REG, \
   MAX(RES.MAX_FECHA) MAX_FECHA \
FROM \
( \
SELECT /*TEN.FECHA_BASE, */ \
    MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        (ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) - \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5))*100000 DIFF_MM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(AVG(TEN.PROBABILIDAD),5) PROBABILIDAD, \
        SUM(CANTIDAD) CANTIDAD, COUNT(*) REGISTROS \
    FROM ( \
      SELECT \
        /*TEN4.FECHA_BASE FECHA_BASE, */ \
        MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO, \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM, \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD, \
        COUNT(*) CANTIDAD, \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS \
        FROM TENDENCIA TEN4 \
             INNER JOIN (SELECT ? FECHA_PROCESO FROM DUAL) FP \
          ON TEN4.FECHA_BASE=FP.FECHA_PROCESO \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO) \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO \
          AND TEN4.FECHA_TENDENCIA<=? \
          AND TEN4.FECHA_APERTURA>FP.FECHA_PROCESO-60 \
       GROUP BY \
		TO_CHAR(TEN4.FECHA_TENDENCIA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(TEN4.FECHA_TENDENCIA, 'HH24')/7)||':'||FLOOR(TO_CHAR(TEN4.FECHA_TENDENCIA, 'MI')/4), \
		TO_CHAR(TEN4.FECHA_APERTURA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(TEN4.FECHA_APERTURA, 'HH24')/9)||':'||FLOOR(TO_CHAR(TEN4.FECHA_APERTURA, 'MI')/34) \
        ) TEN \
GROUP BY \
	TO_CHAR(TEN.FECHA_TENDENCIA, 'YYYY/MM/DD HH24:MI') \
) RES \
GROUP BY \
TO_CHAR(RES.MIN_FECHA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(RES.MIN_FECHA, 'HH24')/6)||':'||FLOOR(TO_CHAR(RES.MIN_FECHA, 'MI')/3) \
HAVING ABS((SUM(RES.PIPS_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD))*AVG(RES.PROBABILIDAD))>0 \
	AND SUM(CANTIDAD)>0\

QUERY_TENDENCIA_GENETICA=SELECT \
    MIN(RES.MIN_FECHA) MIN_FECHA, \
    ROUND(SUM(RES.PRECIO_BASE_PROM)/COUNT(RES.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
    MIN(RES.VALOR_MAS_PROBABLE) MIN_PRECIO, \
    MAX(RES.VALOR_MAS_PROBABLE) MAX_PRECIO, \
    (MAX(RES.VALOR_MAS_PROBABLE)-MIN(RES.VALOR_MAS_PROBABLE))*100000 DIFF_MM, \
    ROUND(SUM(RES.VALOR_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
    ROUND(SUM(RES.PIPS_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
    ROUND(AVG(RES.PROBABILIDAD),5) PROBABILIDAD, \
    SUM(CANTIDAD) CANTIDAD, COUNT(*) REG, \
   MAX(RES.MAX_FECHA) MAX_FECHA \
FROM \
( \
SELECT \
    MIN(TEN.FECHA_TENDENCIA) MIN_FECHA, MAX(TEN.FECHA_TENDENCIA) MAX_FECHA, \
        ROUND(SUM(TEN.PRECIO_BASE_PROM)/COUNT(TEN.PRECIO_BASE_PROM),5) PRECIO_BASE_PROM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MIN_PRECIO, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) MAX_PRECIO, \
        (ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)-STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5) - \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD)+STDDEV(TEN.PIPS*TEN.PROBABILIDAD)/100000,5))*100000 DIFF_MM, \
        ROUND(SUM(TEN.PRECIO_CALCULADO*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) VALOR_MAS_PROBABLE, \
        ROUND(SUM(TEN.PIPS*TEN.PROBABILIDAD)/SUM(TEN.PROBABILIDAD),5) PIPS_MAS_PROBABLE, \
        ROUND(AVG(TEN.PROBABILIDAD),5) PROBABILIDAD, \
        SUM(CANTIDAD) CANTIDAD, COUNT(*) REGISTROS \
    FROM ( \
      SELECT \
        MIN(TEN4.FECHA_TENDENCIA) FECHA_TENDENCIA, \
        SUM(TEN4.PRECIO_CALCULADO*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_CALCULADO, \
        SUM(TEN4.PRECIO_BASE*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PRECIO_BASE_PROM, \
        AVG(TEN4.PROBABILIDAD) PROBABILIDAD, \
        COUNT(*) CANTIDAD, \
        SUM(TEN4.PIPS*TEN4.PROBABILIDAD)/SUM(TEN4.PROBABILIDAD) PIPS \
        FROM TENDENCIA TEN4 \
             INNER JOIN (SELECT ? FECHA_PROCESO FROM DUAL) FP \
          ON TEN4.FECHA_BASE=FP.FECHA_PROCESO \
          AND (TEN4.FECHA_CIERRE IS NULL OR TEN4.FECHA_CIERRE>FP.FECHA_PROCESO) \
          AND TEN4.FECHA_TENDENCIA>=FP.FECHA_PROCESO \
          AND TEN4.FECHA_TENDENCIA<=? \
          AND TEN4.FECHA_APERTURA>FP.FECHA_PROCESO-60 \
       GROUP BY \
		TO_CHAR(TEN4.FECHA_TENDENCIA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(TEN4.FECHA_TENDENCIA, 'HH24')/?)||':'||FLOOR(TO_CHAR(TEN4.FECHA_TENDENCIA, 'MI')/?), \
		TO_CHAR(TEN4.FECHA_APERTURA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(TEN4.FECHA_APERTURA, 'HH24')/?)||':'||FLOOR(TO_CHAR(TEN4.FECHA_APERTURA, 'MI')/?) \
        ) TEN \
GROUP BY \
	TO_CHAR(TEN.FECHA_TENDENCIA, 'YYYY/MM/DD HH24:MI') \
) RES \
GROUP BY \
TO_CHAR(RES.MIN_FECHA, 'YYYY/MM/DD')||' '||FLOOR(TO_CHAR(RES.MIN_FECHA, 'HH24')/?)||':'||FLOOR(TO_CHAR(RES.MIN_FECHA, 'MI')/?) \
HAVING ABS((SUM(RES.PIPS_MAS_PROBABLE*RES.PROBABILIDAD)/SUM(RES.PROBABILIDAD))*AVG(RES.PROBABILIDAD))>? \
	AND SUM(CANTIDAD)>? \
